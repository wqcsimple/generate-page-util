package com.lear.domain.model

import com.fly.base.core.Core
import com.fly.base.exception.NotExistsException
import com.fly.base.model.Model
import com.fly.base.model.BaseModel
import com.fasterxml.jackson.annotation.JsonProperty

/**
*  <%= tableComment %>
*/
@Model(tableName = "<%= tableName %>")
class <%= modelName %> : BaseModel() {

    <% fieldList.forEach(function (item) { %>@get:JsonProperty("<%= item['jsonName'] %>") var <%= item['modelName'] %>: <%= item['dataType'] %> = <%- item['dataTypeValue'] %> <% if (item['comment']) { %> // <%= item["comment"] %> <% } %>
    <% }); %>

    override fun ID(): Long? {
        return id
    }

    override fun keys(): Array<String> {
        return arrayOf(<%- fieldString %>)
    }

    fun basicKeys(): Array<String> {
        return keys
    }

    fun detailKeys(): Array<String> {
        return arrayOf(<%- fieldString %>)
    }

    override fun process(model: Any, keys: Array<String>?): Map<String, Any>? {
        val map = Core.processModel(model, keys)

        if (map != null)
        {

        }

        return map
    }

    companion object {

        val keys = arrayOf(<%- fieldString %>)

        fun findById(id: Long): <%= modelName %>? {
            return Core.Q().findById(<%= modelName %>::class.java, id)
        }

        fun findOrFail(id: Long): <%= modelName %> {
            return findById(id) ?: throw NotExistsException()
        }

        fun getRawById(id: Long): Map<String, Any>? {
            val data = findById(id) ?: return null
            return data.process()
        }
    }
}
